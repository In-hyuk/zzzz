CREATE TABLE DEPARTMENT(
    CODE CHAR(3) PRIMARY KEY,
    D_NAME VARCHAR2(100)
);

CREATE TABLE POSITION(
    CODE INT PRIMARY KEY,
    P_NAME VARCHAR2(100)
);

CREATE TABLE HR(
    NUM CHAR(5) PRIMARY KEY,
    D_CODE CHAR(3),
    P_CODE INT,
    NAME VARCHAR2(100),
    AGE INT,
    GENDER CHAR(1),
    HP VARCHAR2(15) UNIQUE
);

INSERT INTO DEPARTMENT VALUES('1', '인사부');
INSERT INTO DEPARTMENT VALUES('2', '지원부');
INSERT INTO DEPARTMENT VALUES('3', '잡부');

INSERT INTO POSITION VALUES(1,'사장');
INSERT INTO POSITION VALUES(2,'부장');
INSERT INTO POSITION VALUES(3,'사원');

INSERT INTO HR VALUES('100','1',1,'김일동',50,'M','010-1111-1111');
INSERT INTO HR VALUES('101','2',2,'이이동',40,'W','010-2222-2222');
INSERT INTO HR VALUES('102','3',3,'김삼동',30,'M','010-3333-3333');
INSERT INTO HR VALUES('103','2',3,'이사동',20,'W','010-4444-4444');
INSERT INTO HR VALUES('104','3',3,'김오동',60,'M','010-5555-5555');
INSERT INTO HR VALUES('105','1',3,'이육동',25,'W','010-6666-6666');
INSERT INTO HR VALUES('106','2',3,'김칠동',35,'M','010-7777-7777');
INSERT INTO HR VALUES('107','3',2,'이팔동',45,'W','010-8888-8888');
INSERT INTO HR VALUES('108','1',3,'김구동',55,'M','010-9999-9999');
INSERT INTO HR VALUES('109','2',3,'이십동',65,'W','010-0000-0000');

-- 성이 이씨인 사람을 찾는 쿼리를 작성(like 혹은 구글링이나 gpt 쓰기)
SELECT * FROM HR WHERE NAME LIKE '이%';
-- 가장 많은 나이는 몇 살인지 출력
SELECT MAX(AGE) FROM HR;
-- 가장 나이가 어린 사람은 누구인지 출력(중첩질의문을 쓰면 되는 데 무슨 말인지 모르면 구글링이나 gpt)
SELECT * FROM HR WHERE AGE = (SELECT MIN(AGE) FROM HR);
-- 가장 나이가 많은 부서 찾기(평균 나이 기준)
SELECT * FROM ABC;
SELECT 부서명, AVG(AGE) FROM ABC GROUP BY 부서명 ORDER BY AVG(AGE) DESC FETCH FIRST 1 ROW ONLY;
-- 성별 별 평균 나이 출력하기
SELECT AVG(AGE) FROM HR GROUP BY GENDER;
-- 인사 테이블을 출력하되, 부서코드와 직급코드들도 부서명과 직급명으로 출력하기 즉, 3개의 테이블을 서로 조인해야 함
ALTER TABLE HR ADD CONSTRAINT D_CODE FOREIGN KEY (D_CODE) REFERENCES DEPARTMENT(CODE);
ALTER TABLE HR ADD CONSTRAINT P_CODE FOREIGN KEY (P_CODE) REFERENCES POSITION(CODE);
CREATE VIEW ABC AS SELECT NUM, D_NAME 부서명, P_NAME 직급명, NAME, AGE, GENDER, HP FROM DEPARTMENT, POSITION, HR WHERE D_CODE = DEPARTMENT.CODE AND P_CODE=POSITION.CODE;
SELECT * FROM ABC;

COMMIT;
